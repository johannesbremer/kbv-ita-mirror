<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>


	<artifactId>xpm-kvdt-praxis</artifactId>
	<version>2025.2.3</version>
	<parent>
		<groupId>de.kbv.xpm</groupId>
		<artifactId>xpm-parent</artifactId>
		<version>0.0.13</version>
	</parent>

	<properties>
		<!-- !!! ANPASSEN !!! -->
		<quartalVar>2</quartalVar>
		<jahrVar>2025</jahrVar>
		<xpmStammdatenVersion>2025.2.5</xpmStammdatenVersion>
		<xpmCoreVersionKVDT>4.2.32</xpmCoreVersionKVDT>
		<kvdtCommonVersion>2025.2.5</kvdtCommonVersion> <!-- Muss aktualisiert werden bei Core-Update -->
		<xpmCommonFilesVersion>1.1.8</xpmCommonFilesVersion>
		<!-- in der ersten Version eines neuen Quartals hier am Ende .0 eintragen -->
		<pruefAssiFilesVersion>${jahrVar}.${quartalVar}.4</pruefAssiFilesVersion> <!-- muss hochgezählt werden vor dem Start des Release Jobs des XPM-KVDT-Praxis -->

		<pruefmodulTyp>KVDTP</pruefmodulTyp>
		<modulDataContainerName>kbv_tabelle</modulDataContainerName>
		<project.build.sourceEncoding>iso-8859-1</project.build.sourceEncoding>
		<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
		<maven.compiler.release>17</maven.compiler.release>
		<maven.build.timestamp.format>yyyyMMdd'T'HHmmss</maven.build.timestamp.format>
	</properties>

	<profiles>
		<profile>
			<!-- mvn package -Pgenerate-stamm-all | mvn package -P!generate-stamm-all -->
			<id>generate-stamm-all</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>exec-maven-plugin</artifactId>
						<version>3.4.0</version>
						<executions>
							<!-- muss nur aktiviert werden wenn sich Stammdateien, Jasper Reports,
								XPMAdapter Klasse, oder XDT-Schema geändert haben -->
							<execution>
								<id>build-stamm-haupt</id>
								<phase>process-classes</phase>
								<goals>
									<goal>exec</goal>
								</goals>
								<configuration>
									<executable>java</executable>
									<arguments> <!-- <argument>-Dencoding=ISO-8859-1</argument> --> <!-- -->
										<argument>-Dfile.encoding=ISO-8859-1</argument>
										<!-- <argument>-Dfile.encoding=UTF-8</argument> -->
										<argument>-classpath</argument>
										<!-- automatically creates the classpath using all project dependencies,
											also adding the project build directory -->
										<classpath />
										<argument>de.kbv.xpm.modul.kvdt.praxis.generate.Generate</argument>
										<argument>${project.basedir}/src/main/buildResources/Profile.xml</argument>
									</arguments>
								</configuration>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-compiler-plugin</artifactId>
						<version>3.13.0</version>
						<executions>
							<!-- nach dem die XDT-Reader Klasse aus dem XML-Schema generiert wurde
								muss diese noch kompiliert werden -->
							<execution>
								<id>recompile</id>
								<phase>generate-test-resources</phase>
								<goals>
									<goal>compile</goal>
								</goals>
								<configuration>
									<!-- includes> <include>**/XDTReader.java</include> </includes> -->
								</configuration>
							</execution>
						</executions>
					</plugin>

					<plugin>
						<groupId>org.codehaus.mojo</groupId>
						<artifactId>build-helper-maven-plugin</artifactId>
						<version>3.6.0</version>
						<executions>
							<execution>
								<id>attach-artifacts</id>
								<phase>package</phase>
								<goals>
									<goal>attach-artifact</goal>
								</goals>
								<configuration>
									<artifacts>
										<artifact>
											<file>target/${project.name}-${project.version}.zip</file>
											<type>zip</type>
											<classifier>zipArchive</classifier>
										</artifact>
									</artifacts>
								</configuration>
							</execution>
						</executions>
					</plugin>

				</plugins>
			</build>
		</profile>

		<!-- Die generierten Stammdateien unter kbvtab werden in einem zusätzlichen
			JAR ins Artifactory exportiert -->
		<profile>
			<id>export-serialized-masterdata</id>
			<build>
				<plugins>
					<plugin>
						<!-- NOTE: We don't need a groupId specification because the group
							is org.apache.maven.plugins ...which is assumed by default. -->
						<artifactId>maven-assembly-plugin</artifactId>
						<version>3.7.1</version>
						<executions>
							<execution>
								<configuration>
									<descriptors>
										<descriptor>src/main/buildResources/assembly_filesForPruefassiToZip.xml</descriptor>
									</descriptors>
									<appendAssemblyId>false</appendAssemblyId>
									<attach>false</attach>
									<finalName>filesForPruefassi-${pruefAssiFilesVersion}</finalName>
								</configuration>
								<id>make-masterdataZip</id> <!-- this is used for inheritance merges -->
								<phase>package</phase> <!-- bind to the packaging phase -->
								<goals>
									<goal>single</goal>
								</goals>
							</execution>
						</executions>
					</plugin>

					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-install-plugin</artifactId>
						<version>3.1.2</version>
						<configuration>
							<groupId>de.kbv.xpm</groupId>
							<artifactId>pruefAssistentFilesProQuartal</artifactId>
							<version>${pruefAssiFilesVersion}</version>
							<packaging>zip</packaging>
							<file>${project.build.directory}/filesForPruefassi-${pruefAssiFilesVersion}.zip</file>
							<generatePom>true</generatePom>
						</configuration>
						<executions>
							<execution>
								<id>install-jar-lib</id>
								<goals>
									<goal>install-file</goal>
								</goals>
								<phase>install</phase>
							</execution>
						</executions>
					</plugin>

					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-deploy-plugin</artifactId>
						<version>3.1.2</version>
						<executions>
							<execution>
								<id>deploy-pruefassiFiles</id>
								<phase>deploy</phase>
								<goals>
									<goal>deploy-file</goal>
								</goals>
								<configuration>
									<packaging>zip</packaging>
									<generatePom>true</generatePom>
									<repositoryId>jfrog</repositoryId>
									<url>https://jfrog.kbv.de/artifactory/maven-releases</url>
									<artifactId>pruefAssistentFilesProQuartal</artifactId>
									<groupId>${project.groupId}</groupId>
									<version>${pruefAssiFilesVersion}</version>
									<file>${project.build.directory}/filesForPruefassi-${pruefAssiFilesVersion}.zip</file>
								</configuration>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>

	<build>
		<resources>
			<resource>
				<directory>${project.basedir}/src/main/scripts</directory>
				<filtering>true</filtering>
				<targetPath>../</targetPath>
			</resource>
			<resource>
				<directory>${project.basedir}/src/main/resources</directory>
				<filtering>true</filtering>
			</resource>
			<resource>
				<directory>${project.basedir}/src/main/buildResources</directory>
				<includes>
					<include>releaseNotes/*.*</include>
					<include>Meldungen.xml</include>
				</includes>
				<filtering>true</filtering>
				<targetPath>../</targetPath>
			</resource>
		</resources>

		<pluginManagement>
			<plugins>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-compiler-plugin</artifactId>
					<version>3.13.0</version>
				</plugin>
			</plugins>
		</pluginManagement>

		<plugins>

			<plugin>
				<!-- Vor dem generieren müssen die gemeinsamen Daten von praxis und kV
					entpackt unter Target liegen -->
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-dependency-plugin</artifactId>
				<version>3.7.1</version>
				<executions>
					<execution>
						<id>unpack</id>
						<phase>process-classes</phase>
						<goals>
							<goal>unpack</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>de.kbv.xpm</groupId>
									<artifactId>xpm-kvdt-common</artifactId>
									<version>${kvdtCommonVersion}</version>
									<type>zip</type>
									<classifier>additional_common_files</classifier>
									<overWrite>true</overWrite>
									<outputDirectory>${project.build.directory}/additional_common_files</outputDirectory>
								</artifactItem>
								<artifactItem>
									<groupId>de.kbv.xpm</groupId>
									<artifactId>xpm-stammdaten</artifactId>
									<version>${xpmStammdatenVersion}</version>
									<type>zip</type>
									<classifier>Archive</classifier>
									<overWrite>true</overWrite>
									<outputDirectory>${project.build.directory}/stammdaten</outputDirectory>
								</artifactItem>
								<artifactItem>
									<groupId>de.kbv.xpm</groupId>
									<artifactId>xpm-common-files</artifactId>
									<version>${xpmCommonFilesVersion}</version>
									<type>zip</type>
									<classifier>common_files_xpm</classifier>
									<overWrite>true</overWrite>
									<outputDirectory>${project.build.directory}/common_files_xpm</outputDirectory>
								</artifactItem>
							</artifactItems>
							<overWriteReleases>true</overWriteReleases>
							<overWriteSnapshots>true</overWriteSnapshots>
						</configuration>
					</execution>
					<execution>
						<id>copy-installed</id>
						<phase>package</phase>
						<goals>
							<goal>copy</goal>
						</goals>
						<configuration>
							<artifactItems>
								<artifactItem>
									<groupId>de.kbv.xpm</groupId>
									<artifactId>xpmJavaVersionCheck</artifactId>
									<version>${xpmJavaVersionCheckVersion}</version>
								</artifactItem>
								<artifactItem>
									<groupId>de.kbv.xpm</groupId>
									<artifactId>xpm-core</artifactId>
									<version>${xpmCoreVersionKVDT}</version>
								</artifactItem>
								<artifactItem>
									<groupId>de.kbv.xpm</groupId>
									<artifactId>xpm-core</artifactId>
									<classifier>single</classifier>
									<version>${xpmCoreVersionKVDT}</version>
								</artifactItem>
								<artifactItem>
									<groupId>net.sf.jasperreports</groupId>
									<artifactId>jasperreports-fonts</artifactId>
									<version>6.12.2</version>
								</artifactItem>
							</artifactItems>
							<outputDirectory>${project.build.directory}</outputDirectory>
							<useBaseVersion>true</useBaseVersion>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<!-- NOTE: We don't need a groupId specification because the group is
					org.apache.maven.plugins ...which is assumed by default. -->
				<artifactId>maven-assembly-plugin</artifactId>
				<version>3.7.1</version>
				<executions>
					<execution>
						<id>make-kvdt-complete-jar</id> <!-- this is used for inheritance merges -->
						<phase>package</phase> <!-- bind to the packaging phase -->
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<descriptors>
								<descriptor>src/main/buildResources/assembly_kvdt_jar_with_kvdt_common_included.xml</descriptor>
							</descriptors>
							<appendAssemblyId>false</appendAssemblyId>
							<finalName>${project.artifactId}-${project.version}</finalName>
						</configuration>
					</execution>
					<!-- Zip erstellen -->
					<execution>
						<id>make-assembly</id> <!-- this is used for inheritance merges -->
						<phase>package</phase> <!-- bind to the packaging phase -->
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<descriptors>
								<descriptor>src/main/buildResources/assembly.xml</descriptor>
							</descriptors>
							<appendAssemblyId>false</appendAssemblyId>
							<attach>false</attach>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-resources-plugin</artifactId>
				<version>3.3.1</version>
				<configuration>
					<encoding>ISO-8859-1</encoding>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>3.3.1</version>
				<configuration>
					<excludes>
						<exclude>**/TestKVDTPraxisAufrufe.java</exclude>
					</excludes>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-checkstyle-plugin</artifactId>
				<version>3.4.0</version>
				<executions>
					<execution>
						<id>validatewin</id>
						<phase>validate</phase>
						<configuration>
							<encoding>ISO-8859-1</encoding>
							<consoleOutput>true</consoleOutput>
							<failsOnError>true</failsOnError>
							<linkXRef>false</linkXRef>
							<includes>**\/*.bat</includes>
							<includeResources>true</includeResources>
							<resourceIncludes>**\/*.bat</resourceIncludes>
							<configLocation>src/main/buildResources/checkstylewindows.xml</configLocation>
						</configuration>
						<goals>
							<goal>check</goal>
						</goals>
					</execution>
					<execution>
						<id>validatelinux</id>
						<phase>validate</phase>
						<configuration>
							<encoding>ISO-8859-1</encoding>
							<consoleOutput>true</consoleOutput>
							<failsOnError>true</failsOnError>
							<linkXRef>false</linkXRef>
							<includes>**\/*.sh</includes>
							<includeResources>true</includeResources>
							<resourceIncludes>**\/*.sh</resourceIncludes>
							<configLocation>src/main/buildResources/checkstyle.xml</configLocation>
						</configuration>
						<goals>
							<goal>check</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-enforcer-plugin</artifactId>
				<version>3.5.0</version>
				<executions>
					<execution>
						<id>check-Stammdaten-für-alle-KVs-vorhanden</id>
						<phase>package</phase>
						<goals>
							<goal>enforce</goal>
						</goals>
						<configuration>
							<rules>
								<requireFilesSize>
									<maxsize>4000000</maxsize>
									<minsize>5000</minsize>
									<files>
										<file>${project.build.directory}/AnbieterStamm.bin</file>
										<file>${project.build.directory}/kbv_tabelle.bin</file>
										<file>${project.build.directory}/KTStamm.bin</file>
										<file>${project.build.directory}/OPSStamm.bin</file>
										<file>${project.build.directory}/PLZStamm.bin</file>
										<file>${project.build.directory}/stammdaten/OMIM/OMIMG.xml</file>
										<file>${project.build.directory}/stammdaten/OMIM/OMIMP.xml</file>
										<file>${project.build.directory}/GOStamm_KV01.bin</file>
										<file>${project.build.directory}/GOStamm_KV02.bin</file>
										<file>${project.build.directory}/GOStamm_KV03.bin</file>
										<file>${project.build.directory}/GOStamm_KV17.bin</file>
										<file>${project.build.directory}/GOStamm_KV20.bin</file>
										<file>${project.build.directory}/GOStamm_KV38.bin</file>
										<file>${project.build.directory}/GOStamm_KV46.bin</file>
										<file>${project.build.directory}/GOStamm_KV51.bin</file>
										<file>${project.build.directory}/GOStamm_KV52.bin</file>
										<file>${project.build.directory}/GOStamm_KV71.bin</file>
										<file>${project.build.directory}/GOStamm_KV72.bin</file>
										<file>${project.build.directory}/GOStamm_KV73.bin</file>
										<file>${project.build.directory}/GOStamm_KV74.bin</file>
										<file>${project.build.directory}/GOStamm_KV78.bin</file>
										<file>${project.build.directory}/GOStamm_KV83.bin</file>
										<file>${project.build.directory}/GOStamm_KV88.bin</file>
										<file>${project.build.directory}/GOStamm_KV93.bin</file>
										<file>${project.build.directory}/GOStamm_KV98.bin</file>
									</files>
								</requireFilesSize>
							</rules>
							<fail>true</fail>
						</configuration>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>

	<dependencies>
		<dependency>
			<groupId>de.kbv.xpm</groupId>
			<artifactId>xpm-kvdt-common</artifactId>
			<version>${kvdtCommonVersion}</version>
		</dependency>
		<!-- Jasper-Report Dateien und XDT-Schema -->
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>4.11</version>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>de.kbv.xpm</groupId>
			<artifactId>xpmJavaVersionCheck</artifactId>
			<version>${xpmJavaVersionCheckVersion}</version>
		</dependency>
	</dependencies>

	<scm>
		<url>https://bitbucket.kbv.de/scm/itasw/xpm-kvdt-praxis.git</url>
		<connection>scm:git:https://bitbucket.kbv.de/scm/itasw/xpm-kvdt-praxis.git</connection>
		<developerConnection>scm:git:https://bitbucket.kbv.de/scm/itasw/xpm-kvdt-praxis.git</developerConnection>
		<tag>xpm-kvdt-praxis-2025.2.3</tag>
	</scm>
</project>