{
  "resourceType": "StructureDefinition",
  "id": "KBV-PR-VoS-Provenance-ePrescription",
  "url": "https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Provenance_ePrescription",
  "version": "2.2.0",
  "name": "KBV_PR_VoS_Provenance_ePrescription",
  "title": "KBV_PR_VoS_Provenance_ePrescription",
  "status": "draft",
  "date": "2025-10-01",
  "publisher": "Kassenärztliche Bundesvereinigung",
  "description": "Eine Provenance-Ressource, die von der VoS an das PVS gesendet wird, um ein storniertes eRezept im Storno-Fall im PVS als obsolet markieren zu können.",
  "fhirVersion": "4.0.1",
  "kind": "resource",
  "abstract": false,
  "type": "Provenance",
  "baseDefinition": "https://fhir.kbv.de/StructureDefinition/KBV_PR_Base_Provenance|1.7.0",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "Provenance.id",
        "path": "Provenance.id",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.meta",
        "path": "Provenance.meta",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.meta.source",
        "path": "Provenance.meta.source",
        "max": "0"
      },
      {
        "id": "Provenance.meta.profile",
        "path": "Provenance.meta.profile",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "$this"
            }
          ],
          "rules": "open"
        },
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.meta.profile:vosProfile",
        "path": "Provenance.meta.profile",
        "sliceName": "vosProfile",
        "min": 1,
        "max": "1",
        "fixedCanonical": "https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Provenance_ePrescription|2.2.0",
        "mustSupport": true
      },
      {
        "id": "Provenance.meta.security",
        "path": "Provenance.meta.security",
        "max": "0"
      },
      {
        "id": "Provenance.meta.tag",
        "path": "Provenance.meta.tag",
        "max": "0"
      },
      {
        "id": "Provenance.implicitRules",
        "path": "Provenance.implicitRules",
        "max": "0"
      },
      {
        "id": "Provenance.language",
        "path": "Provenance.language",
        "max": "0"
      },
      {
        "id": "Provenance.contained",
        "path": "Provenance.contained",
        "max": "0"
      },
      {
        "id": "Provenance.target",
        "path": "Provenance.target",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "type"
            }
          ],
          "rules": "closed"
        },
        "short": "Referenzen des eRezepts",
        "definition": "Referenzen auf das signierte eRezept-Bundle und den Patietenausdruck als DocumentReferences und das eRezept-Bundle",
        "max": "3",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_DocumentReference|2.2.0",
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Bundle"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Provenance.target:eRezept",
        "path": "Provenance.target",
        "sliceName": "eRezept",
        "short": "eRezept-Bundle",
        "definition": "Referenz auf das gelöschte eRezept-Bundle gemäß KBV_PR_ERP_Bundle",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Bundle"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Provenance.target:eRezept.reference",
        "path": "Provenance.target.reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.target:eRezept.type",
        "path": "Provenance.target.type",
        "min": 1,
        "fixedUri": "Bundle",
        "mustSupport": true
      },
      {
        "id": "Provenance.target:eRezept.identifier",
        "path": "Provenance.target.identifier",
        "max": "0"
      },
      {
        "id": "Provenance.target:eRezept.display",
        "path": "Provenance.target.display",
        "max": "0"
      },
      {
        "id": "Provenance.target:DokRef",
        "path": "Provenance.target",
        "sliceName": "DokRef",
        "short": "signiertes eRezept / Patientenausdruck",
        "definition": "Referenzen auf das signierte eRezept (DocumentReference mit PKCS#7-Datei) und den Patientenausdruck, auf dem die zu löschende Verordnung enthalten ist.\r\n\r\nDie Referenz auf das signierte eRezept ist mandatorisch.",
        "min": 1,
        "max": "2",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_DocumentReference|2.2.0"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Provenance.target:DokRef.reference",
        "path": "Provenance.target.reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.target:DokRef.type",
        "path": "Provenance.target.type",
        "min": 1,
        "fixedUri": "DocumentReference",
        "mustSupport": true
      },
      {
        "id": "Provenance.target:DokRef.identifier",
        "path": "Provenance.target.identifier",
        "max": "0"
      },
      {
        "id": "Provenance.target:DokRef.display",
        "path": "Provenance.target.display",
        "max": "0"
      },
      {
        "id": "Provenance.occurred[x]",
        "path": "Provenance.occurred[x]",
        "type": [
          {
            "code": "dateTime"
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Provenance.occurred[x]:occurredDateTime",
        "path": "Provenance.occurred[x]",
        "sliceName": "occurredDateTime",
        "type": [
          {
            "code": "dateTime"
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Provenance.recorded",
        "path": "Provenance.recorded",
        "mustSupport": true
      },
      {
        "id": "Provenance.policy",
        "path": "Provenance.policy",
        "max": "0"
      },
      {
        "id": "Provenance.location",
        "path": "Provenance.location",
        "max": "0"
      },
      {
        "id": "Provenance.reason",
        "path": "Provenance.reason",
        "max": "0"
      },
      {
        "id": "Provenance.activity",
        "path": "Provenance.activity",
        "definition": "Festlegung, dass die durchgeführte Aktivität ein LÖSCHEN / DELETE ist. Hierdurch wird deutlich, dass die in .target referenzierten Ressourcen im PVS als gelöscht markiert werden können.",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.activity.coding",
        "path": "Provenance.activity.coding",
        "min": 1,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Provenance.activity.coding.system",
        "path": "Provenance.activity.coding.system",
        "min": 1,
        "fixedUri": "http://terminology.hl7.org/CodeSystem/v3-DataOperation",
        "mustSupport": true
      },
      {
        "id": "Provenance.activity.coding.code",
        "path": "Provenance.activity.coding.code",
        "min": 1,
        "fixedCode": "DELETE",
        "mustSupport": true
      },
      {
        "id": "Provenance.activity.coding.userSelected",
        "path": "Provenance.activity.coding.userSelected",
        "max": "0"
      },
      {
        "id": "Provenance.activity.text",
        "path": "Provenance.activity.text",
        "max": "0"
      },
      {
        "id": "Provenance.agent",
        "path": "Provenance.agent",
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "Provenance.agent.type",
        "path": "Provenance.agent.type",
        "max": "0"
      },
      {
        "id": "Provenance.agent.role",
        "path": "Provenance.agent.role",
        "max": "0"
      },
      {
        "id": "Provenance.agent.who",
        "path": "Provenance.agent.who",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Practitioner|2.2.0",
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_PractitionerRole|2.2.0"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Provenance.agent.who.reference",
        "path": "Provenance.agent.who.reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.agent.who.type",
        "path": "Provenance.agent.who.type",
        "max": "0"
      },
      {
        "id": "Provenance.agent.who.identifier",
        "path": "Provenance.agent.who.identifier",
        "max": "0"
      },
      {
        "id": "Provenance.agent.who.display",
        "path": "Provenance.agent.who.display",
        "max": "0"
      },
      {
        "id": "Provenance.agent.onBehalfOf",
        "path": "Provenance.agent.onBehalfOf",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Organization|2.2.0"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "Provenance.agent.onBehalfOf.reference",
        "path": "Provenance.agent.onBehalfOf.reference",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "Provenance.agent.onBehalfOf.type",
        "path": "Provenance.agent.onBehalfOf.type",
        "max": "0"
      },
      {
        "id": "Provenance.agent.onBehalfOf.identifier",
        "path": "Provenance.agent.onBehalfOf.identifier",
        "max": "0"
      },
      {
        "id": "Provenance.agent.onBehalfOf.display",
        "path": "Provenance.agent.onBehalfOf.display",
        "max": "0"
      },
      {
        "id": "Provenance.entity",
        "path": "Provenance.entity",
        "max": "0"
      },
      {
        "id": "Provenance.signature",
        "path": "Provenance.signature",
        "max": "0"
      }
    ]
  }
}
