<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="KBV-PR-VoS-DocumentReference" />
  <url value="https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_DocumentReference" />
  <version value="2.1.0" />
  <name value="KBV_PR_VoS_DocumentReference" />
  <title value="KBV_PR_VoS_DocumentReference" />
  <status value="active" />
  <date value="2023-02-01" />
  <publisher value="Kassenärztliche Bundesvereinigung" />
  <description value="Übergabe von Rezepten, signierten eRezepten oder Medikationsplänen als pkcs#7-, pdf- oder XML-Dateien vom PVS an die VoS und vice versa." />
  <fhirVersion value="4.0.1" />
  <mapping>
    <identity value="workflow" />
    <uri value="http://hl7.org/fhir/workflow" />
    <name value="Workflow Pattern" />
  </mapping>
  <mapping>
    <identity value="fhircomposition" />
    <uri value="http://hl7.org/fhir/composition" />
    <name value="FHIR Composition" />
  </mapping>
  <mapping>
    <identity value="rim" />
    <uri value="http://hl7.org/v3" />
    <name value="RIM Mapping" />
  </mapping>
  <mapping>
    <identity value="cda" />
    <uri value="http://hl7.org/v3/cda" />
    <name value="CDA (R2)" />
  </mapping>
  <mapping>
    <identity value="w5" />
    <uri value="http://hl7.org/fhir/fivews" />
    <name value="FiveWs Pattern Mapping" />
  </mapping>
  <mapping>
    <identity value="v2" />
    <uri value="http://hl7.org/v2" />
    <name value="HL7 v2 Mapping" />
  </mapping>
  <mapping>
    <identity value="xds" />
    <uri value="http://ihe.net/xds" />
    <name value="XDS metadata equivalent" />
  </mapping>
  <kind value="resource" />
  <abstract value="false" />
  <type value="DocumentReference" />
  <baseDefinition value="https://fhir.kbv.de/StructureDefinition/KBV_PR_Base_DocumentReference|1.3.0" />
  <derivation value="constraint" />
  <differential>
    <element id="DocumentReference">
      <path value="DocumentReference" />
      <definition value="Das Profil beinhaltet ein Rezept, ein signiertes eRezept oder einen Medikationsplan als pkcs#7-, pdf- oder XML-Datei" />
      <constraint>
        <key value="Extension-eRezept" />
        <severity value="error" />
        <human value="Die Extension mit den Zugriffsdaten des eRezepts muss genau dann verwendet werden, wenn der DokumentenTyp ein signiertes eRezept ist." />
        <expression value="(extension('https://fhir.kbv.de/StructureDefinition/KBV_EX_VoS_ePrescription_Access').empty() and (type.coding.where(code='Signiertes_eRezept').exists().not())) or (extension('https://fhir.kbv.de/StructureDefinition/KBV_EX_VoS_ePrescription_Access').exists() and type.coding.where(code='Signiertes_eRezept').exists())" />
      </constraint>
    </element>
    <element id="DocumentReference.id">
      <path value="DocumentReference.id" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.meta">
      <path value="DocumentReference.meta" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.meta.source">
      <path value="DocumentReference.meta.source" />
      <max value="0" />
    </element>
    <element id="DocumentReference.meta.profile">
      <path value="DocumentReference.meta.profile" />
      <min value="1" />
      <max value="1" />
      <fixedCanonical value="https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_DocumentReference|2.1.0" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.meta.security">
      <path value="DocumentReference.meta.security" />
      <max value="0" />
    </element>
    <element id="DocumentReference.meta.tag">
      <path value="DocumentReference.meta.tag" />
      <max value="0" />
    </element>
    <element id="DocumentReference.implicitRules">
      <path value="DocumentReference.implicitRules" />
      <max value="0" />
    </element>
    <element id="DocumentReference.language">
      <path value="DocumentReference.language" />
      <max value="0" />
    </element>
    <element id="DocumentReference.contained">
      <path value="DocumentReference.contained" />
      <max value="0" />
    </element>
    <element id="DocumentReference.extension">
      <path value="DocumentReference.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="closed" />
      </slicing>
      <min value="0" />
	  <max value="1" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten">
      <path value="DocumentReference.extension" />
      <sliceName value="eRezept-Zugriffsdaten" />
      <min value="0" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.kbv.de/StructureDefinition/KBV_EX_VoS_ePrescription_Access|2.1.0" />
      </type>
      <mustSupport value="true" />
      <isModifier value="false" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten.extension">
      <path value="DocumentReference.extension.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="closed" />
      </slicing>
      <min value="2" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten.extension:AccessCode">
      <path value="DocumentReference.extension.extension" />
      <sliceName value="AccessCode" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten.extension:AccessCode.value[x]">
      <path value="DocumentReference.extension.extension.value[x]" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten.extension:AccessCode.value[x]:valueString">
      <path value="DocumentReference.extension.extension.value[x]" />
      <sliceName value="valueString" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten.extension:Task-ID">
      <path value="DocumentReference.extension.extension" />
      <sliceName value="Task-ID" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten.extension:Task-ID.value[x]">
      <path value="DocumentReference.extension.extension.value[x]" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.extension:eRezept-Zugriffsdaten.extension:Task-ID.value[x]:valueString">
      <path value="DocumentReference.extension.extension.value[x]" />
      <sliceName value="valueString" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.masterIdentifier">
      <path value="DocumentReference.masterIdentifier" />
      <short value="Versionsspezifischer Identifikator" />
      <definition value="Angabe eines versionsabhängigen Identifiers für das Dokument." />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.masterIdentifier.use">
      <path value="DocumentReference.masterIdentifier.use" />
      <max value="0" />
    </element>
    <element id="DocumentReference.masterIdentifier.type">
      <path value="DocumentReference.masterIdentifier.type" />
      <max value="0" />
    </element>
    <element id="DocumentReference.masterIdentifier.value">
      <path value="DocumentReference.masterIdentifier.value" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.masterIdentifier.period">
      <path value="DocumentReference.masterIdentifier.period" />
      <max value="0" />
    </element>
    <element id="DocumentReference.masterIdentifier.assigner">
      <path value="DocumentReference.masterIdentifier.assigner" />
      <max value="0" />
    </element>
    <element id="DocumentReference.identifier">
      <path value="DocumentReference.identifier" />
      <short value="Versionsunabhängiger Identifikator" />
      <definition value="Angabe von versionsunabhängigen Identifiern für das Dokument." />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.identifier.use">
      <path value="DocumentReference.identifier.use" />
      <max value="0" />
    </element>
    <element id="DocumentReference.identifier.type">
      <path value="DocumentReference.identifier.type" />
      <max value="0" />
    </element>
    <element id="DocumentReference.identifier.value">
      <path value="DocumentReference.identifier.value" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.identifier.period">
      <path value="DocumentReference.identifier.period" />
      <max value="0" />
    </element>
    <element id="DocumentReference.identifier.assigner">
      <path value="DocumentReference.identifier.assigner" />
      <max value="0" />
    </element>
    <element id="DocumentReference.status">
      <path value="DocumentReference.status" />
      <fixedCode value="current" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.docStatus">
      <path value="DocumentReference.docStatus" />
      <max value="0" />
    </element>
    <element id="DocumentReference.type">
      <path value="DocumentReference.type" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.type.coding">
      <path value="DocumentReference.type.coding" />
      <slicing>
        <discriminator>
          <type value="pattern" />
          <path value="$this" />
        </discriminator>
        <rules value="closed" />
      </slicing>
      <min value="1" />
      <max value="2" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.type.coding:Dokumententyp">
      <path value="DocumentReference.type.coding" />
      <sliceName value="Dokumententyp" />
      <min value="1" />
      <max value="1" />
      <mustSupport value="true" />
      <binding>
        <strength value="required" />
        <valueSet value="https://fhir.kbv.de/ValueSet/KBV_VS_VoS_DocumentType" />
      </binding>
    </element>
    <element id="DocumentReference.type.coding:Dokumententyp.system">
      <path value="DocumentReference.type.coding.system" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.type.coding:Dokumententyp.code">
      <path value="DocumentReference.type.coding.code" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.type.coding:XDS">
      <path value="DocumentReference.type.coding" />
      <sliceName value="XDS" />
      <short value="Dokumenttyp gem. IHE-De-Terminologie" />
      <definition value="Die Übermittlung des XDS-Type-Codes ist im Rahmen der Dokumentenbereitstellung für Clients nicht verpflichtend, muss jedoch vom Server bei der Entgegennahme ggf. ergänzt und bei der Dokumentenabfrage zurückgegeben werden. Der XDS-Type-Code kann über die im Rahmen der [KDL-Spezifikation](https://simplifier.net/kdl) publizierten [ConceptMaps](https://simplifier.net/kdl/~resources?category=ConceptMap) aus dem KDL-Code ermittelt werden." />
      <max value="1" />
      <patternCoding>
        <system value="http://ihe-d.de/CodeSystems/IHEXDStypeCode" />
      </patternCoding>
      <mustSupport value="true" />
      <binding>
        <strength value="required" />
        <valueSet value="http://ihe-d.de/ValueSets/IHEXDStypeCode" />
      </binding>
    </element>
    <element id="DocumentReference.type.coding:XDS.system">
      <path value="DocumentReference.type.coding.system" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.type.coding:XDS.code">
      <path value="DocumentReference.type.coding.code" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.type.coding:XDS.display">
      <path value="DocumentReference.type.coding.display" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.type.text">
      <path value="DocumentReference.type.text" />
      <max value="0" />
    </element>
    <element id="DocumentReference.category">
      <path value="DocumentReference.category" />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.category.coding">
      <path value="DocumentReference.category.coding" />
      <slicing>
        <discriminator>
          <type value="pattern" />
          <path value="$this" />
        </discriminator>
        <rules value="closed" />
      </slicing>
      <min value="1" />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.category.coding:XDS">
      <path value="DocumentReference.category.coding" />
      <sliceName value="XDS" />
      <min value="1" />
      <max value="1" />
      <patternCoding>
        <system value="http://ihe-d.de/CodeSystems/IHEXDSclassCode" />
      </patternCoding>
      <binding>
        <strength value="required" />
        <valueSet value="http://ihe-d.de/ValueSets/IHEXDSclassCode" />
      </binding>
    </element>
    <element id="DocumentReference.category.coding:XDS.system">
      <path value="DocumentReference.category.coding.system" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.category.coding:XDS.code">
      <path value="DocumentReference.category.coding.code" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.category.coding:XDS.display">
      <path value="DocumentReference.category.coding.display" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.subject">
      <path value="DocumentReference.subject" />
      <type>
        <code value="Reference" />
        <targetProfile value="https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Patient|2.1.0" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.subject.reference">
      <path value="DocumentReference.subject.reference" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.subject.type">
      <path value="DocumentReference.subject.type" />
      <max value="0" />
    </element>
    <element id="DocumentReference.subject.identifier">
      <path value="DocumentReference.subject.identifier" />
      <max value="0" />
    </element>
    <element id="DocumentReference.subject.display">
      <path value="DocumentReference.subject.display" />
      <max value="0" />
    </element>
    <element id="DocumentReference.date">
      <path value="DocumentReference.date" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author">
      <path value="DocumentReference.author" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="type" />
        </discriminator>
        <rules value="closed" />
      </slicing>
      <max value="2" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:Behandelnder">
      <path value="DocumentReference.author" />
      <sliceName value="Behandelnder" />
      <max value="1" />
      <type>
        <code value="Reference" />
        <targetProfile value="https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Practitioner|2.1.0" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:Behandelnder.reference">
      <path value="DocumentReference.author.reference" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:Behandelnder.type">
      <path value="DocumentReference.author.type" />
      <min value="1" />
      <fixedUri value="Practitioner" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:Behandelnder.identifier">
      <path value="DocumentReference.author.identifier" />
      <max value="0" />
    </element>
    <element id="DocumentReference.author:Behandelnder.display">
      <path value="DocumentReference.author.display" />
      <max value="0" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem">
      <path value="DocumentReference.author" />
      <sliceName value="AusstellendesSystem" />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.reference">
      <path value="DocumentReference.author.reference" />
      <max value="0" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.type">
      <path value="DocumentReference.author.type" />
      <min value="1" />
      <fixedUri value="Device" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.identifier">
      <path value="DocumentReference.author.identifier" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.identifier.use">
      <path value="DocumentReference.author.identifier.use" />
      <max value="0" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.identifier.type">
      <path value="DocumentReference.author.identifier.type" />
      <max value="0" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.identifier.system">
      <path value="DocumentReference.author.identifier.system" />
      <min value="1" />
      <fixedUri value="https://fhir.kbv.de/NamingSystem/KBV_NS_FOR_Pruefnummer" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.identifier.value">
      <path value="DocumentReference.author.identifier.value" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.identifier.period">
      <path value="DocumentReference.author.identifier.period" />
      <max value="0" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.identifier.assigner">
      <path value="DocumentReference.author.identifier.assigner" />
      <max value="0" />
    </element>
    <element id="DocumentReference.author:AusstellendesSystem.display">
      <path value="DocumentReference.author.display" />
      <max value="0" />
    </element>
    <element id="DocumentReference.authenticator">
      <path value="DocumentReference.authenticator" />
      <max value="0" />
    </element>
    <element id="DocumentReference.custodian">
      <path value="DocumentReference.custodian" />
      <type>
        <code value="Reference" />
        <targetProfile value="https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Organization|2.1.0" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.custodian.reference">
      <path value="DocumentReference.custodian.reference" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.custodian.type">
      <path value="DocumentReference.custodian.type" />
      <max value="0" />
    </element>
    <element id="DocumentReference.custodian.identifier">
      <path value="DocumentReference.custodian.identifier" />
      <max value="0" />
    </element>
    <element id="DocumentReference.custodian.display">
      <path value="DocumentReference.custodian.display" />
      <max value="0" />
    </element>
    <element id="DocumentReference.relatesTo">
      <path value="DocumentReference.relatesTo" />
      <short value="Medikationsplanverknüpfung" />
      <definition value="Verknüpfung zwischen verschiedenen Repräsentationen (PDF oder XML) eines bundeseinheitlichen Medikationsplans. In diesem Fall ist relatesTo.code = transforms. Alternativ können auch Verknüpfungen zwischen verschiedenen Seiten eines bundeseinheitlichen Medikationsplans übertragen werden. In diesem Fall ist relatesTo.code = appends." />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.relatesTo.code">
      <path value="DocumentReference.relatesTo.code" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.relatesTo.target">
      <path value="DocumentReference.relatesTo.target" />
      <type>
        <code value="Reference" />
        <targetProfile value="https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_DocumentReference|2.1.0" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.relatesTo.target.reference">
      <path value="DocumentReference.relatesTo.target.reference" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.relatesTo.target.type">
      <path value="DocumentReference.relatesTo.target.type" />
      <max value="0" />
    </element>
    <element id="DocumentReference.relatesTo.target.identifier">
      <path value="DocumentReference.relatesTo.target.identifier" />
      <max value="0" />
    </element>
    <element id="DocumentReference.relatesTo.target.display">
      <path value="DocumentReference.relatesTo.target.display" />
      <max value="0" />
    </element>
    <element id="DocumentReference.description">
      <path value="DocumentReference.description" />
      <max value="0" />
    </element>
    <element id="DocumentReference.securityLabel">
      <path value="DocumentReference.securityLabel" />
      <max value="0" />
    </element>
    <element id="DocumentReference.content">
      <path value="DocumentReference.content" />
      <definition value="Hier wird das Dokument in Form eines formatierten Anhangs abgebildet." />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.content.attachment">
      <path value="DocumentReference.content.attachment" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.content.attachment.contentType">
      <path value="DocumentReference.content.attachment.contentType" />
      <definition value="Hier wird das Dateiformat ausgewählt. PDF-Dokument: application/pdf, XML-Dokument: application/xml, pkcs#7-Datei: application/pkcs7-mime" />
      <min value="1" />
      <mustSupport value="true" />
      <binding>
        <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName">
          <valueString value="MimeType" />
        </extension>
        <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-isCommonBinding">
          <valueBoolean value="true" />
        </extension>
        <strength value="required" />
        <valueSet value="https://fhir.kbv.de/ValueSet/KBV_VS_VoS_ContentTypes" />
      </binding>
    </element>
    <element id="DocumentReference.content.attachment.data">
      <path value="DocumentReference.content.attachment.data" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.context">
      <path value="DocumentReference.context" />
      <definition value="Verweis auf die im PDF-Ausdruck eines Rezeptes vorhandenen FHIR-Ressourcen gemäß https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Prescription bzw. auf die eRezept-Bundles gemäß https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Bundle aus dem Patientenausdruck." />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.context.encounter">
      <path value="DocumentReference.context.encounter" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.event">
      <path value="DocumentReference.context.event" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.period">
      <path value="DocumentReference.context.period" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.facilityType">
      <path value="DocumentReference.context.facilityType" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.practiceSetting">
      <path value="DocumentReference.context.practiceSetting" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.sourcePatientInfo">
      <path value="DocumentReference.context.sourcePatientInfo" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.related">
      <path value="DocumentReference.context.related" />
      <min value="1" />
      <type>
        <code value="Reference" />
        <targetProfile value="https://fhir.kbv.de/StructureDefinition/KBV_PR_VoS_Prescription|2.1.0" />
        <targetProfile value="https://fhir.kbv.de/StructureDefinition/KBV_PR_ERP_Bundle" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.context.related.reference">
      <path value="DocumentReference.context.related.reference" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="DocumentReference.context.related.type">
      <path value="DocumentReference.context.related.type" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.related.identifier">
      <path value="DocumentReference.context.related.identifier" />
      <max value="0" />
    </element>
    <element id="DocumentReference.context.related.display">
      <path value="DocumentReference.context.related.display" />
      <max value="0" />
    </element>
  </differential>
</StructureDefinition>